# Release v1.1.4

**Release Date:** 2025-12-23

## ğŸ« New Feature: Breathing & Apnea Data Support

### Added Support for Respiratory and Sleep Apnea Metrics

**What's New:** The `get_sleep_summary` tool now supports requesting breathing disturbances, apnea, and respiratory rate data through the `data_fields` parameter.

**New Available Metrics:**
- ğŸ« **Breathing Disturbances Intensity (BDI)** - Sleep breathing quality indicator
- ğŸ’¤ **Apnea-Hypopnea Index (AHI)** - Number of apnea/hypopnea events per hour
- ğŸ˜´ **Snoring** - Snoring episode count and duration
- ğŸŒ¬ï¸ **Respiratory Rate** - Average, minimum, and maximum breathing rate

## Changes

### Enhanced `get_sleep_summary` Tool

**New Parameter:**
- `data_fields` (optional): Comma-separated list of data fields to request

**Example Usage:**

```json
{
  "startdateymd": "2025-12-23",
  "enddateymd": "2025-12-23",
  "data_fields": "breathing_disturbances_intensity,apnea_hypopnea_index,snoring,rr_average,rr_min,rr_max"
}
```

**Available Data Fields:**
- `breathing_disturbances_intensity` - BDI score
- `apnea_hypopnea_index` - AHI score
- `snoring` - Snoring episodes
- `snoring_eposode_count` - Count of snoring episodes
- `rr_average` - Average respiratory rate (breaths/min)
- `rr_min` - Minimum respiratory rate
- `rr_max` - Maximum respiratory rate

### Technical Details

Modified `src/withings_mcp_server/server.py`:
1. Added `data_fields` parameter to `get_sleep_summary` tool schema
2. Updated implementation to pass `data_fields` to Withings API
3. Enhanced tool description to mention breathing and apnea metrics

## Device Compatibility

These metrics are available on compatible Withings devices:
- **Sleep Analyzer (Model 63)** - Full support for apnea detection
- **Sleep Analyzer V2 (Model 32)** - May have limited support

Check your device's `model_id` in the sleep summary response to verify capabilities.

## Impact

- âœ… Access breathing disturbances and apnea data from Withings Sleep Analyzer
- âœ… Request specific data fields to reduce response size
- âœ… Compatible with existing code - `data_fields` is optional
- âœ… No breaking changes

## Upgrade Instructions

Update to the latest version:

```bash
pip install --upgrade withings-mcp-server
```

Or if installed in editable mode:

```bash
cd /path/to/withings-mcp-server
git pull
```

Then restart Claude Desktop.

## Notes

If you receive a token refresh error after upgrading, regenerate your tokens:

```bash
python generate_tokens.py
```

This ensures you have the latest OAuth2 tokens with proper scope permissions.
